<html>
	<head>
		<!-- Mobile Viewport --> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
 
		<!-- iOS Full Screen --> 
		<meta name="apple-mobile-web-app-capable" content="yes" /> 
 
		<!-- iOS Status Bar Style (default, black, black-translucent) --> 
		<meta name="apple-mobile-web-app-status-bar-style" content="black" /> 

		<style type="text/css">

			* { 
				-webkit-tap-highlight-color: rgba(0,0,0,0);
				-webkit-text-size-adjust: none;
				-webkit-touch-callout: none; 
			}
 
			body {
 				margin: 0;
 				padding: 0;
 				overflow: hidden;
			}
 
			canvas {
				background-color: #333;
				border: 1px solid #999999;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				cursor: crosshair;				
			}
		</style>	
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
		<script src="/socket.io/socket.io.js"></script> 
		<script>
			jQuery(function($) {

				var resizeCanvas = function () {
					var canvasWidth = $(document).width();
					var canvasHeight = $(document).height();
			
					$(canvas).attr("height", canvasHeight);
					$(canvas).attr("width", canvasWidth);
				};

				var canvas = $("canvas");
				resizeCanvas();

				var pen = canvas[0].getContext("2d");
				pen.lineWidth = 5;
				pen.lineCap = "butt";
				pen.lineJoin = "round";
				pen.strokeStyle = "#0066CC";
				pen.shadowColor = "#0066CC";
				pen.shadowBlur = 2;
				var lastPenPoint = null;

				var deviceAgent = navigator.userAgent.toLowerCase();
				var isIPhone = deviceAgent.match(/(iphone|ipod|ipad)/);

				var getCanvasLocalCoordinates = function(pageX, pageY) {
					var position = canvas.offset();
					return({
						x: (pageX - position.left),
						y: (pageY - position.top)
					});
				};

				var sendCommand = function(command, point) {
					socket.send({command: command, point: point});
				};

				var moveTo = function(x, y) {
					var localPosition = getCanvasLocalCoordinates(x, y);
					lastPenPoint = {
						x: localPosition.x,
						y: localPosition.y
					};
					pen.beginPath();
					pen.moveTo(lastPenPoint.x, lastPenPoint.y);					
				};

				var lineTo = function(x, y) {
					var localPosition = getCanvasLocalCoordinates(x, y);
					lastPenPoint = {
						x: localPosition.x,
						y: localPosition.y	
					};
					pen.lineTo(lastPenPoint.x, lastPenPoint.y);
					pen.stroke();
				};

				var getTouchEvent = function(event) {
					return(
						isIPhone 
							? window.event.targetTouches[0]
							: event);
				};

				var onTouchStart = function(event) {
					var touch = getTouchEvent(event);
					event.preventDefault();

					moveTo(touch.pageX, touch.pageY);					
					sendCommand('moveTo', lastPenPoint);

					canvas.bind( (isIPhone ? "touchmove" : "mousemove"), onTouchMove);
					canvas.bind( (isIPhone ? "touchend": "mouseup"), onTouchEnd);
				};

				var onTouchMove = function(event) {
					var touch = getTouchEvent(event);
					
					lineTo(touch.pageX, touch.pageY);
					sendCommand('lineTo', lastPenPoint);
				};

				var onTouchEnd = function(event) {
					canvas.unbind((isIPhone ? "touchmove" : "mousemove"));
					canvas.unbind((isIPhone ? "touchend" : "mouseup"));
				};

				canvas.bind((isIPhone ? "touchstart" : "mousedown"), function(event) {
					onTouchStart(event);
				});

	 			var socket = new io.Socket(); 
	 			socket.connect();
	 			socket.on('connect', function() {
	 				
	 			});
	 			socket.on('message', function(message) {
	 				var cmd = message.command;
	 				var point = message.point;
	 				if (cmd != undefined) {
	 					if (cmd == 'moveTo') {
	 						moveTo(point.x, point.y);
	 					}
	 					else if (cmd == 'lineTo') {
	 						lineTo(point.x, point.y);
	 					}
	 				}
	 			});
	 			socket.on('disconnect', function() {
	 				
	 			});

			});
		</script>
	</head>
	<body>
		<canvas id="canvas">
		</canvas>
	</body>
</html>